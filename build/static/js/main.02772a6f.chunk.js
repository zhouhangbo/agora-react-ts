(this.webpackJsonpagora=this.webpackJsonpagora||[]).push([[0],{164:function(e,t,n){},165:function(e,t,n){},294:function(e,t,n){"use strict";n.r(t);var a=n(7),r=n(0),i=n(25),s=n.n(i),c=(n(164),n(80)),o=n(81),l=n(100),u=n(97),d=(n(165),n(73)),m=n(42),p=n.n(m),b=n(68),h=n(82),j=n(298),f=n(306),x=n(307),v=n(300),O=n(302),g=n(299),y=n(67),k=n(305),S=n(301),I=n(303),w=n(113),C=n(308),F=n(309),P=n(310),T=n(311);var D,E=function(e){var t=Object(r.useState)(!0),n=Object(w.a)(t,2),i=n[0],s=n[1],c=Object(r.useState)(!0),o=Object(w.a)(c,2),l=o[0],u=o[1];return Object(a.jsxs)("div",{style:{padding:"8px"},children:[Object(a.jsx)("div",{id:e.name,style:{width:"480px",height:"320px"}},e.name),i?Object(a.jsx)(F.a,{onClick:function(){e.stream.muteVideo(),s(!1)}}):Object(a.jsx)(C.a,{onClick:function(){e.stream.unmuteVideo(),s(!0)}}),l?Object(a.jsx)(T.a,{onClick:function(){e.stream.muteAudio(),u(!1)}}):Object(a.jsx)(P.a,{onClick:function(){e.stream.unmuteAudio(),u(!0)}})]})},R=j.a.Content,A=[{name:"default",value:"default"},{name:"480p",value:"480p"},{name:"720p",value:"720p"},{name:"1080p",value:"1080p"}],L={client:null,localStream:null,remoteStreams:[]},V=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).state={cameraIdOptions:[],microphoneIdOptions:[],joined:!1,published:!1,uid:0,remoteStreams:[]},e.formRef=r.createRef(),e.layout={labelCol:{span:8},wrapperCol:{span:16}},e.tailLayout={wrapperCol:{offset:8,span:16}},e.onFinish=function(e){console.log("Success:",e)},e.onFinishFailed=function(e){console.log("Failed:",e)},e.handleEvents=function(e){L.client.on("error",(function(e){console.log(e)})),L.client.on("peer-leave",(function(t){var n=t.uid;console.log("id",t);var a=L.remoteStreams.filter((function(e){return n!==e.getId()})),r=L.remoteStreams.find((function(e){return n===e.getId()}));r&&r.isPlaying()&&r.stop(),L.remoteStreams=a,e.setState({remoteStreams:L.remoteStreams}),e.state.uid,f.b.success("peer leave"),console.log("peer-leave",n)})),L.client.on("stream-published",(function(e){f.b.success("stream published success"),console.log("stream-published")})),L.client.on("stream-added",(function(t){var n=t.stream,a=n.getId();f.b.info("stream-added uid: "+a),a!==e.state.uid&&L.client.subscribe(n,(function(e){console.log("stream subscribe failed",e)})),console.log("stream-added remote-uid: ",a)})),L.client.on("stream-subscribed",(function(t){var n=t.stream,a=n.getId();L.remoteStreams.push(n),e.setState({remoteStreams:L.remoteStreams}),setTimeout((function(){return n.play("remote_video_"+a)}),100),f.b.info("stream-subscribed remote-uid: "+a),console.log("stream-subscribed remote-uid: ",a)})),L.client.on("stream-removed",(function(t){var n=t.stream,a=n.getId();f.b.info("stream-removed uid: "+a),n.isPlaying()&&n.stop(),L.remoteStreams=L.remoteStreams.filter((function(e){return e.getId()!==a})),e.setState({remoteStreams:L.remoteStreams}),console.log("stream-removed remote-uid: ",a)})),L.client.on("onTokenPrivilegeWillExpire",(function(){f.b.info("onTokenPrivilegeWillExpire"),console.log("onTokenPrivilegeWillExpire")})),L.client.on("onTokenPrivilegeDidExpire",(function(){f.b.info("onTokenPrivilegeDidExpire"),console.log("onTokenPrivilegeDidExpire")}))},e.join=Object(b.a)(p.a.mark((function t(){var n,a;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.formRef.current.getFieldsValue(),!e.state.joined){t.next=4;break}return f.b.error("Your already joined"),t.abrupt("return");case 4:return L.client=D.createClient({mode:n.mode,codec:n.codec}),t.prev=5,t.next=8,e.sync(L.client.init,n.appId);case 8:return t.next=10,e.sync(L.client.join,n.token,n.channel,n.uid);case 10:return a=t.sent,e.setState({uid:a,joined:!0}),L.localStream=D.createStream({streamID:a,audio:!0,video:!0,screen:!1,microphoneId:n.microphoneId,cameraId:n.cameraId}),t.next=15,e.sync(L.localStream.init);case 15:L.localStream.play("local_stream"),e.publish(),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(5),x.a.error({message:"client join failed ",description:t.t0});case 22:e.handleEvents(Object(h.a)(e));case 23:case"end":return t.stop()}}),t,null,[[5,19]])}))),e.leave=Object(b.a)(p.a.mark((function t(){var n,a;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(L.client){t.next=3;break}return f.b.error("Please Join First!"),t.abrupt("return");case 3:if(e.state.joined){t.next=6;break}return f.b.error("You are not in channel"),t.abrupt("return");case 6:return t.prev=6,t.next=9,e.sync(L.client.leave);case 9:for(t.sent,L.localStream.isPlaying()&&L.localStream.stop(),L.localStream.close(),n=0;n<L.remoteStreams.length;n++)a=L.remoteStreams.shift(),a.getId(),a.isPlaying()&&a.stop();L.localStream=null,L.remoteStreams=[],L.client=null,console.log("client leaves channel success"),e.setState({joined:!1,published:!1}),f.b.success("leave success"),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(6),x.a.error({message:"channel leave failed ",description:t.t0});case 24:case"end":return t.stop()}}),t,null,[[6,21]])}))),e.publish=Object(b.a)(p.a.mark((function t(){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(L.client){t.next=3;break}return f.b.error("Please Join Room First"),t.abrupt("return");case 3:if(!e.state.published){t.next=6;break}return f.b.error("Your already published"),t.abrupt("return");case 6:return t.prev=6,t.next=9,e.syncFail(L.client.publish,L.localStream);case 9:f.b.success("publish success"),e.setState({published:!0}),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(6),x.a.error({message:"publish failed ",description:t.t0});case 16:case"end":return t.stop()}}),t,null,[[6,13]])}))),e.unpublish=Object(b.a)(p.a.mark((function t(){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(L.client){t.next=3;break}return f.b.error("Please Join Room First"),t.abrupt("return");case 3:if(e.state.published){t.next=6;break}return f.b.error("Your didn\b\b\b't publish"),t.abrupt("return");case 6:return t.prev=6,t.next=9,e.syncFail(L.client.unpublish,L.localStream);case 9:f.b.success("unpublish success"),e.setState({published:!1}),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(6),x.a.error({message:"unpublish failed ",description:t.t0});case 16:case"end":return t.stop()}}),t,null,[[6,13]])}))),e.sync=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return new Promise((function(t,a){e.apply(void 0,n.concat([function(e){return t(e)},function(e){return a(e)}]))}))},e.syncFail=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return new Promise((function(t,a){e.apply(void 0,n.concat([function(e){return a(e)}])),t(1)}))},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;setTimeout(Object(b.a)(p.a.mark((function t(){var n,a,r,i,s,c,o,l,u,d;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return D=window.AgoraRTC,console.log("agora sdk version: "+D.VERSION+" compatible: "+D.checkSystemRequirements()),n=function(t,n){e.setState({cameraIdOptions:t,microphoneIdOptions:n})},t.prev=3,t.next=6,e.sync(D.getDevices);case 6:a=t.sent,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),x.a.error({message:"Failed to getDevice",description:t.t0});case 12:for(r=[],i=[],s=0;s<a.length;s++)"videoinput"==(c=a[s]).kind&&(o=c.label,l=c.deviceId,o||(o="camera-"+r.length),r.push({label:o,value:l,kind:c.kind})),"audioinput"==c.kind&&(u=c.label,d=c.deviceId,u||(u="microphone-"+i.length),i.push({label:u,value:d,kind:c.kind}));n(r,i);case 16:case"end":return t.stop()}}),t,null,[[3,9]])}))),500)}},{key:"render",value:function(){return Object(a.jsxs)(R,{style:{minHeight:"100px"},children:[Object(a.jsxs)(v.a,Object(d.a)(Object(d.a)({},this.layout),{},{ref:this.formRef,name:"basic",initialValues:{remember:!0},onFinish:this.onFinish,onFinishFailed:this.onFinishFailed,children:[Object(a.jsx)(v.a.Item,{label:"appId",name:"appId",rules:[{required:!0,message:"Please input your appID!"}],children:Object(a.jsx)(O.a,{})}),Object(a.jsx)(v.a.Item,{label:"channel",name:"channel",rules:[{required:!0,message:"Please input your Channel!"}],children:Object(a.jsx)(O.a,{})}),Object(a.jsx)(v.a.Item,{label:"token",name:"token",rules:[{required:!0,message:"Please input your Token!"}],children:Object(a.jsx)(O.a,{})}),Object(a.jsx)(v.a.Item,Object(d.a)(Object(d.a)({},this.tailLayout),{},{children:Object(a.jsxs)(g.a,{gutter:16,children:[Object(a.jsx)(y.a,{type:"primary",htmlType:"submit",onClick:this.join,style:{marginLeft:"8px"},children:"JOIN"}),Object(a.jsx)(y.a,{type:"primary",htmlType:"submit",onClick:this.leave,style:{marginLeft:"8px"},children:"LEAVE"}),Object(a.jsx)(y.a,{type:"primary",htmlType:"submit",onClick:this.publish,style:{marginLeft:"8px"},children:"PUBLISH"}),Object(a.jsx)(y.a,{type:"primary",htmlType:"submit",onClick:this.unpublish,style:{marginLeft:"8px"},children:"UNPUBLISH"})]})})),Object(a.jsx)(v.a.Item,{label:"uid",name:"uid",children:Object(a.jsx)(k.a,{value:this.state.uid})}),Object(a.jsx)(v.a.Item,{label:"cameraId",name:"cameraId",children:Object(a.jsx)(S.a,{options:this.state.cameraIdOptions})}),Object(a.jsx)(v.a.Item,{label:"microphoneId",name:"microphoneId",children:Object(a.jsx)(S.a,{options:this.state.microphoneIdOptions})}),Object(a.jsx)(v.a.Item,{label:"cameraResolution",name:"cameraResolution",initialValue:A[0].value,children:Object(a.jsx)(S.a,{options:A})}),Object(a.jsx)(v.a.Item,{label:"mode",name:"mode",initialValue:"rtc",children:Object(a.jsxs)(I.a.Group,{children:[Object(a.jsx)(I.a,{value:"rtc",children:"rtc"}),Object(a.jsx)(I.a,{value:"live",disabled:!0,children:"live"})]})}),Object(a.jsx)(v.a.Item,{label:"codec",name:"codec",initialValue:"h264",children:Object(a.jsxs)(I.a.Group,{children:[Object(a.jsx)(I.a,{value:"h264",children:"h264"}),Object(a.jsx)(I.a,{value:"vp8",children:"vp8"})]})})]})),Object(a.jsxs)("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:[this.state.joined&&Object(a.jsx)(E,{stream:L.localStream,name:"local_stream"}),this.state.remoteStreams.map((function(e){return Object(a.jsx)(E,{stream:e,name:"remote_video_"+e.getId()})}))]})]})}}]),n}(r.Component),q=n(114),J=n(304),N=j.a.Header,_=j.a.Content,B=j.a.Footer,H=function(){return Object(a.jsxs)(j.a,{className:"layout",children:[Object(a.jsxs)(N,{children:[Object(a.jsx)("div",{className:"logo"}),Object(a.jsx)(q.a,{theme:"dark",mode:"horizontal",defaultSelectedKeys:["1"],children:Object(a.jsx)(q.a.Item,{children:"\u89c6\u9891\u901a\u8bdd"},"1")})]}),Object(a.jsxs)(_,{style:{padding:"0 50px"},children:[Object(a.jsx)(J.a,{style:{margin:"16px 0"},children:Object(a.jsx)(J.a.Item,{children:"Demo"})}),Object(a.jsx)("div",{className:"site-layout-content",children:Object(a.jsx)(V,{})})]}),Object(a.jsx)(B,{style:{textAlign:"center"},children:"Ant Design \xa92018 Created by Ant UED"})]})},U=n(95),W={articles:[{id:1,title:"post 1",body:"Quisque cursus, metus vitae pharetra"},{id:2,title:"post 2",body:"Quisque cursus, metus vitae pharetra"}]},Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W;return e},G=n(152),K=Object(U.b)(Y),Q=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=document.createElement("script");return e.type="text/javascript",e.async=!0,e.src="https://oss.dev.jiandanchina.com/common/AgoraRTCSDK.js",document.head.appendChild(e),Object(a.jsx)(G.a,{store:K,children:Object(a.jsx)(H,{})})}}]),n}(r.Component),z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,312)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,s=t.getTTFB;n(e),a(e),r(e),i(e),s(e)}))};s.a.render(Object(a.jsx)(Q,{}),document.getElementById("root")),z()}},[[294,1,2]]]);
//# sourceMappingURL=main.02772a6f.chunk.js.map